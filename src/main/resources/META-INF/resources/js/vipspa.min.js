/**
 * vipsap By Suntg 
 * 2016年8月9日14:18:16
 * Jquery或Zepto单页路由插件。
 * 由vipsap(https://github.com/wikieswan/vipspa)改进而成，用于配置单页应用(SPA)路由规则。
 * 提供与angularjs ui-router相似的API。
 * 具体使用请参照文档。
 */
!function(){function a(){}function c(a){var b=[];return a&&$.each(a,function(a,c){var e,f;"defaults"==a?b.defaults=c:(e=[],a=d(a,e),f={url:"^#"+a+"$",params:e,content:c},b.push(f))}),b}function d(a,b){var e,f,h,g,c=a.indexOf(":");if(c>-1){if(e=a.substring(0,c),f=a.substring(c+1),g=f.indexOf("/"),c=f.indexOf(":"),-1==g&&c>-1||(g>-1&&g>c))throw new Error('illegal router config, url: "'+a+'"');g>-1?(h=f.substring(0,g),f=f.substring(g),a=e+"[^/]*"+f):(h=f,a=e+"[^/]*"),b.push({name:h,reg:"^#"+e}),c>g&&(a=d(a,b))}return a}function e(a){var b,c,d,e,f,h,i,j,l,k,m;if(vipspa.params={},vipspa.routerMap.length)for(c=0;c<vipspa.routerMap.length;c++)if(d=vipspa.routerMap[c],e=new RegExp(d.url),e.test(a)){if(b=d.content,d.params&&d.params.length)for(f=0;f<d.params.length;f++)h=d.params[f],e=new RegExp(h.reg),i=e.exec(a),i&&(i=i[0],j=a.substring(i.length),k=j.indexOf("/"),l=k>-1?j.substring(0,k):j,vipspa.params[h.name]=l);break}return"undefined"==typeof b?(m=vipspa.routerMap.defaults,b=vipspa.routerMap[m],location.hash=m,!1):($.ajax({type:"GET",url:b.templateUrl,dataType:"html",success:function(a){$(vipspa.mainView).html(a),g(b.controller)},error:function(a){if(0===$(vipspa.errorTemplateId).length)return!1;var d=$(vipspa.errorTemplateId).html();d=d.replace(/{{errStatus}}/,a.status),d=d.replace(/{{errContent}}/,a.responseText),$(vipspa.mainView).html(d)}}),void 0)}function f(){var a=location.hash;e(a)}function g(a,b){var d,c=document.createElement("script");c.setAttribute("src",a),c.onreadystatechange=c.onload=function(){c.onreadystatechange=null,document.documentElement.removeChild(c),c=null,d||"function"==typeof b&&b(),d=!0},document.documentElement.appendChild(c)}a.prototype.start=function(a){var b=this;b.routerMap=c(a.router),b.mainView=a.view,b.errorTemplateId=a.errorTemplateId,f(),window.onhashchange=function(){f()}};var b=[];a.prototype.getMessage=function(a){var c={};return $.each(b,function(b,d){d.id===a&&(c=d)}),c},a.prototype.setMessage=function(a){var c=JSON.parse(JSON.stringify(a));$.each(b,function(a,b){return b.id===c.id?(b=c,!1):void 0}),b.push(c)},a.prototype.delMessage=function(a){if("undefined"==typeof a)return!1;var c=0;$.each(b,function(b,d){d.id===a&&(c=b)}),$.each(b,function(a,d){a>c&&(b[a-1]=d)})},a.prototype.clearMessage=function(){b=[]},a.prototype.stringify=function(a,b){var d,e,c="";for(e in b)c+=e+"="+encodeURIComponent(b[e])+"&";return""===c?d=a:(c=c.substring(0,c.length-1),d=a+"?"+c),d},window.vipspa=new a}();